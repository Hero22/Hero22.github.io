---
title: 一次WEB请求全过程
date: 2018-08-21 19:23:40
tags:
- three-way handshark
categories: network
---

##  输入URL

首先，用户在Web浏览器（如IE）地址栏输入URL，比如：[https://zero22.top](https://zero22.top) 前面的https是协议类型，后面的zero22.top指定被访问的服务器的域名，没有加冒号和端口号表示访问的是默认的端口号80。

<!--more-->

## DNS解析

由于所发出的数据要通过被访问主机的IP地址进行传输和路由，所以要先通过DNS服务器将域名解析为IP地址：

 1. 主机产生一个DNS请求，传递给传输层，通过UDP产生一个UDP报文；再传递给网络层产生一个IP报文，目的地址是DNS服务器的IP地址；在数据链路层通过ARP协议得到到达DNS服务器的下一跳的MAC地址；把数据帧通过以太网传输给DNS服务器。
 2. DNS服务器将收到的帧向上传给传输层，得到UDP报文。通过UDP报文中指定的端口号传给DNS应用程序。这里，由于是内网域名和内网DNS服务器，DNS服务器中有相应的表项，如果不在当地，本地DNS服务器还要向上级的DNS服务器发出DNS查询请求，如此递归直到查到要解析的域名的IP地址。
 3. DNS把通过DNS应答将得到的IP地址返回给请求的主机。

## HTTP嘶挞哆

现在，浏览器得到对方的IP地址了，即进入HTTP流程。HTTP的工作流程分为以下四步：

 1. 通过三次握手建立TCP连接。
 2. 客户端发送请求给服务器。
 3. 服务器收到请求后，给予相应的响应消息，并传输相应的响应数据给客户端。
 4. 客户端接收完服务器返回的信息后，与服务器断开连接。

### THREE-WAY HANDSHAKE

用Wireshark来看看三次握手：

![总的](https://image.zero22.top/three-way-handshark.png)

首先我给服务器发送一个TCP报文：
![第一次握手](https://image.zero22.top/handshark-1.png)
随后服务器端回我一个：
![第二次握手](https://image.zero22.top/handshark-2.png)
最后我再给服务器发一个：
![第三次握手](https://image.zero22.top/handshark-3.png)
由上边可以知道，客户端和服务器端发送的Sequence number是没有关系的，各自算各自的。

至于建立连接之后，客户端与服务器端数据的传送，现在不想看了，大概根据对方的ip和mac地址，传到相应的主机？解析后主机在给相应的应用程序？不很清楚，再看吧 - -